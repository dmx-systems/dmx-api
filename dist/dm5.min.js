!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("axios"),require("vue"),require("clone"),require("debounce")):"function"==typeof define&&define.amd?define(["axios","vue","clone","debounce"],t):"object"==typeof exports?exports.dm5=t(require("axios"),require("vue"),require("clone"),require("debounce")):e.dm5=t(e.axios,e.vue,e.clone,e.debounce)}(window,(function(e,t,i,n){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t){e.exports=n},function(e,t,i){"use strict";i.r(t);var n=i(0),r=i.n(n),o={isTopicWritable:function(e){return s(e,g.getTopicPermissions)},isAssocWritable:function(e){return s(e,g.getAssocPermissions)},clear:function(){c={}}},c={};function s(e,t){return(c[e]||(c[e]=t(e))).then((function(e){return e["dmx.accesscontrol.operation.write"]}))}var a=i(2),u=i.n(a),p=i(3),f=i.n(p);function l(e){return Array.isArray(e)?e.map((function(e){return new N(e)})):new N(e)}function y(e,t){var i={};return e.forEach((function(e){return i[e[t]]=e})),i}var h=["+","-","&&","||","!","(",")","{","}","[","]","^",'"',"~","*","?",":","\\","AND","OR","NOT"];var d={instantiateMany:function(e,t){return e.map((function(e){return new t(e)}))},instantiateChildren:function(e){var t={};for(var i in e)t[i]=l(e[i]);return t},clone:function(e){return u()(e)},debounce:function(e,t,i){return f()(e,t,i)},mapById:function(e){return y(e,"id")},mapByUri:function(e){return y(e,"uri")},mapByTypeUri:function(e){return y(e,"typeUri")},forEach:function(e,t){for(var i in e)t(e[i])},filter:function(e,t){var i={};for(var n in e){var r=e[n];t(r)&&(i[n]=r)}return i},isEmpty:function(e){return!Object.keys(e).length},getCookie:function(e){var t=document.cookie.match(new RegExp("\\b"+e+"=(\\w*)"));return t&&t[1]},setCookie:function(e,t){document.cookie=e+"="+t+";path=/"},deleteCookie:function(e){var t=new Date;t.setTime(t.getTime()+-864e5),document.cookie=e+"=;path=/;expires="+t.toGMTString()},fulltextQuery:function(e,t){var i=e.trim();return function(e){return h.some((function(t){return e.includes(t)}))}(e)||(i=i.split(/ +/).join(" AND "),e.endsWith(" ")||(1!==i.length||t?i&&(i+="*"):i="")),i}},v=r.a.create(),g={getTopic:function(e,t,i){return r.a.get("/core/topic/"+e,{params:{children:t,assoc_children:i}}).then((function(e){return new N(e.data)}))},getTopicByUri:function(e,t,i){return r.a.get("/core/topic/by_uri/"+e,{params:{children:t,assoc_children:i}}).then((function(e){return new N(e.data)}))},getTopicsByType:function(e){return r.a.get("/core/topic/by_type/"+e).then((function(e){return d.instantiateMany(e.data,N)}))},getTopicRelatedTopics:function(e,t){return r.a.get("/core/topic/"+e+"/related_topics",{params:m(t)}).then((function(e){return d.instantiateMany(e.data,X)}))},queryTopicsFulltext:function(e,t,i){var n={query:e,topic_type_uri:t,search_child_topics:i};return v.get("/core/topic",{params:n}).then((function(e){var t=e.data,i=t.query,n=t.topicTypeUri,r=t.searchChildTopics,o=t.topics;return{query:i,topicTypeUri:n,searchChildTopics:r,topics:d.instantiateMany(o,N)}}))},createTopic:function(e){return r.a.post("/core/topic",e).then((function(e){var t=new N(e.data);return t.directives=e.data.directives,t}))},updateTopic:function(e){return r.a.put("/core/topic/"+e.id,e).then((function(e){return e.data}))},deleteTopic:function(e){return r.a.delete("/core/topic/"+e).then((function(e){return e.data}))},getAssoc:function(e,t,i){return r.a.get("/core/association/"+e,{params:{children:t,assoc_children:i}}).then((function(e){return new L(e.data)}))},getAssocRelatedTopics:function(e,t){return r.a.get("/core/association/"+e+"/related_topics",{params:m(t)}).then((function(e){return d.instantiateMany(e.data,X)}))},createAssoc:function(e){return r.a.post("/core/association",e).then((function(e){var t=new L(e.data);return t.directives=e.data.directives,t}))},updateAssoc:function(e){return r.a.put("/core/association/"+e.id,e).then((function(e){return e.data}))},deleteAssoc:function(e){return r.a.delete("/core/association/"+e).then((function(e){return e.data}))},getRelatedTopicsWithoutChilds:function(e){return r.a.get("/core/object/"+e+"/related_topics").then((function(e){return d.instantiateMany(e.data,X)}))},deleteMulti:function(e){return r.a.delete("/core"+T(e)).then((function(e){return e.data}))},getAllTopicTypes:function(){return r.a.get("/core/topictype/all").then((function(e){return d.instantiateMany(e.data,z)}))},createTopicType:function(e){return r.a.post("/core/topictype",e).then((function(e){return new z(e.data)}))},updateTopicType:function(e){return r.a.put("/core/topictype",e).then((function(e){return e.data}))},getAllAssocTypes:function(){return r.a.get("/core/assoctype/all").then((function(e){return d.instantiateMany(e.data,H)}))},createAssocType:function(e){return r.a.post("/core/assoctype",e).then((function(e){return new H(e.data)}))},updateAssocType:function(e){return r.a.put("/core/assoctype",e).then((function(e){return e.data}))},createRoleType:function(e){return r.a.post("/core/roletype",e).then((function(e){return new N(e.data)}))},getPlugins:function(){return r.a.get("/core/plugin").then((function(e){return e.data}))},getWebsocketConfig:function(){return r.a.get("/core/websockets").then((function(e){return e.data}))},createTopicmap:function(e,t,i){return r.a.post("/topicmap",i,{params:{name:e,topicmap_type_uri:t}}).then((function(e){return new N(e.data)}))},getTopicmap:function(e){return r.a.get("/topicmap/"+e).then((function(e){return new G(e.data)}))},getTopicmapTopics:function(e){return r.a.get("/topicmap/object/"+e).then((function(e){return d.instantiateMany(e.data,X)}))},addTopicToTopicmap:function(e,t,i){w(i,"dmx.topicmaps.x","dmx.topicmaps.y"),r.a.post("/topicmap/"+e+"/topic/"+t,i)},addAssocToTopicmap:function(e,t,i){r.a.post("/topicmap/"+e+"/association/"+t,i)},addRelatedTopicToTopicmap:function(e,t,i,n){n?w(n,"dmx.topicmaps.x","dmx.topicmaps.y"):n={},r.a.post("/topicmap/"+e+"/topic/"+t+"/association/"+i,n)},setTopicViewProps:function(e,t,i){r.a.put("/topicmap/"+e+"/topic/"+t,i)},setAssocViewProps:function(e,t,i){r.a.put("/topicmap/"+e+"/association/"+t,i)},setTopicPosition:function(e,t,i){w(i,"x","y"),r.a.put("/topicmap/"+e+"/topic/"+t+"/"+i.x+"/"+i.y)},setTopicPositions:function(e,t){w(t,"x","y"),r.a.put("/topicmap/"+e,{topicCoords:t})},setTopicVisibility:function(e,t,i){r.a.put("/topicmap/"+e+"/topic/"+t+"/"+i)},hideMulti:function(e,t){r.a.put("/topicmap/"+e+T(t)+"/visibility/false")},setTopicmapViewport:d.debounce((function(e,t,i){w(t,"x","y"),r.a.put("/topicmap/"+e+"/pan/"+t.x+"/"+t.y+"/zoom/"+i)}),3e3),createWorkspace:function(e,t,i){return r.a.post("/workspace",void 0,{params:{name:e,uri:t,sharing_mode_uri:i}}).then((function(e){return e.data}))},getAssignedTopics:function(e,t,i,n){return r.a.get("/workspace/"+e+"/topics/"+t,{params:{children:i,assoc_children:n}}).then((function(e){return d.instantiateMany(e.data,N)}))},getAssignedWorkspace:function(e){return r.a.get("/workspace/object/"+e).then((function(e){return e.data&&new N(e.data)}))},assignToWorkspace:function(e,t){r.a.put("/workspace/"+t+"/object/"+e)},login:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Basic";return v.post("/accesscontrol/login",void 0,{headers:{Authorization:t+" "+btoa(e.username+":"+e.password)}}).then((function(){return o.clear()}))},logout:function(){return r.a.post("/accesscontrol/logout").then((function(){return o.clear()}))},getUsername:function(){return r.a.get("/accesscontrol/user").then((function(e){return e.data}))},getPrivateWorkspace:function(){return r.a.get("/accesscontrol/user/workspace").then((function(e){return new N(e.data)}))},getWorkspaceOwner:function(e){return r.a.get("/accesscontrol/workspace/"+e+"/owner").then((function(e){return e.data}))},getTopicPermissions:function(e){return r.a.get("/accesscontrol/topic/"+e).then((function(e){return e.data}))},getAssocPermissions:function(e){return r.a.get("/accesscontrol/association/"+e).then((function(e){return e.data}))},getCreator:function(e){return r.a.get("/accesscontrol/object/"+e+"/creator").then((function(e){return e.data}))},getModifier:function(e){return r.a.get("/accesscontrol/object/"+e+"/modifier").then((function(e){return e.data}))},getAuthorizationMethods:function(){return r.a.get("/accesscontrol/methods").then((function(e){return e.data}))},createUserAccount:function(e,t){return r.a.post("/accesscontrol/user_account",{username:e,password:t}).then((function(e){return new N(e.data)}))},getCreationTime:function(e){return r.a.get("/timestamps/object/"+e+"/created").then((function(e){return e.data}))},getModificationTime:function(e){return r.a.get("/timestamps/object/"+e+"/modified").then((function(e){return e.data}))},getXML:function(e){return r.a.get(e).then((function(e){return e.request.responseXML.documentElement}))},setErrorHandler:function(e){r.a.interceptors.response.use((function(e){return e}),(function(t){return e(t),Promise.reject(t)}))}};function T(e){var t="";return e.topicIds.length&&(t+="/topics/"+e.topicIds),e.assocIds.length&&(t+="/assocs/"+e.assocIds),t}function m(e){return e&&{assoc_type_uri:e.assocTypeUri,my_role_type_uri:e.myRoleTypeUri,others_role_type_uri:e.othersRoleTypeUri,others_topic_type_uri:e.othersTopicTypeUri}}function w(e,t,i){Array.isArray(e)?e.forEach((function(e){return _(e,t,i)})):_(e,t,i)}function _(e,t,i){e[t]=Math.round(e[t]),e[i]=Math.round(e[i])}var k=i(1),b=i.n(k),x={topicTypes:void 0,assocTypes:void 0,dataTypes:void 0,roleTypes:void 0},A={putTopicType:function(e,t){C(t)},putAssocType:function(e,t){I(t)},putRoleType:function(e,t){j(t)},_newTopicType:function(e,t){O(t.topicType)},_newAssocType:function(e,t){E(t.assocType)},_newRoleType:function(e,t){!function(e){j(new N(e))}(t.roleType)},_processDirectives:function(e,t){t.forEach((function(e){switch(e.type){case"UPDATE_TOPIC_TYPE":O(e.arg);break;case"UPDATE_ASSOCIATION_TYPE":E(e.arg)}})),b.a.nextTick((function(){t.forEach((function(e){switch(e.type){case"DELETE_TOPIC_TYPE":t=e.arg.uri,b.a.delete(x.topicTypes,t);break;case"DELETE_ASSOCIATION_TYPE":!function(e){b.a.delete(x.assocTypes,e)}(e.arg.uri);break;case"DELETE_TOPIC":"dmx.core.role_type"===e.arg.typeUri&&function(e){b.a.delete(x.roleTypes,e)}(e.arg.uri)}var t}))}))}};function P(e,t,i){var n=x[i]&&x[i][e];if(!n)throw Error(t+' "'+e+'" not in type cache');return n}function U(e){return Object.values(x[e])}function O(e){C(new z(e))}function E(e){I(new H(e))}function C(e){D(e,z,"topicTypes")}function I(e){D(e,H,"assocTypes")}function j(e){D(e,N,"roleTypes")}function D(e,t,i){if(!(e instanceof t))throw Error("can't cache \""+e.constructor.name+'", expected is "'+t.name+'", '+JSON.stringify(e));b.a.set(x[i],e.uri,e)}var M={init:function(e){return e.registerModule("typeCache",{state:x,actions:A}),Promise.all([g.getAllTopicTypes().then((function(e){x.topicTypes=d.mapByUri(e),C(new z({uri:"dmx.core.meta_meta_type",typeUri:"dmx.core.meta_meta_meta_type",value:"Meta Meta Type",dataTypeUri:"dmx.core.text",compDefs:[],viewConfigTopics:[]}))})),g.getAllAssocTypes().then((function(e){x.assocTypes=d.mapByUri(e)})),g.getTopicsByType("dmx.core.data_type").then((function(e){x.dataTypes=d.mapByUri(e)})),g.getTopicsByType("dmx.core.role_type").then((function(e){x.roleTypes=d.mapByUri(e)}))]).then((function(){}))},getTopicType:function(e){return P(e,"topic type","topicTypes")},getAssocType:function(e){return P(e,"assoc type","assocTypes")},getDataType:function(e){return P(e,"data type","dataTypes")},getRoleType:function(e){return P(e,"role type","roleTypes")},getTypeById:function(e){var t=Object.values(x.topicTypes).concat(Object.values(x.assocTypes)).filter((function(t){return t.id===e}));if(1!==t.length)throw Error(t.length+" types with ID "+e+" in type cache");return t[0]},getAllTopicTypes:function(){return U("topicTypes")},getAllAssocTypes:function(){return U("assocTypes")},getAllDataTypes:function(){return U("dataTypes")},getAllRoleTypes:function(){return U("roleTypes")}},V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},R=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function W(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var q=function(){function e(t){if(B(this,e),!t)throw Error("invalid object passed to DMXObject constructor: "+t);if("Object"!==t.constructor.name)throw Error("DMXObject constructor expects plain Object, got "+t.constructor.name+" ("+t+")");this.id=t.id,this.uri=t.uri,this.typeUri=t.typeUri,this.value=t.value,this.children=d.instantiateChildren(t.children)}return R(e,[{key:"getCreationTime",value:function(){return g.getCreationTime(this.id)}},{key:"getModificationTime",value:function(){return g.getModificationTime(this.id)}},{key:"getCreator",value:function(){return g.getCreator(this.id)}},{key:"getModifier",value:function(){return g.getModifier(this.id)}},{key:"getWorkspace",value:function(){return g.getAssignedWorkspace(this.id)}},{key:"assignToWorkspace",value:function(e){return g.assignToWorkspace(this.id,e)}},{key:"getTopicmapTopics",value:function(){return g.getTopicmapTopics(this.id)}},{key:"getRelatedTopicsWithoutChilds",value:function(){return g.getRelatedTopicsWithoutChilds(this.id)}},{key:"fillChildren",value:function(){var e=this;return this.type.compDefs.forEach((function(t){var i=e.children[t.compDefUri],n=void 0;i||(n=new N(t.getChildType().emptyInstance())),t.isOne()?(i?i.fillChildren():i=n,i.fillRelatingAssoc(t)):(i?i.forEach((function(e){e.fillChildren()})):i=[n],i.forEach((function(e){e.fillRelatingAssoc(t)}))),n&&b.a.set(e.children,t.compDefUri,i)})),this}},{key:"equals",value:function(e){return this._equals(e)&&(!this.assoc||this.assoc._equals(e.assoc))}},{key:"_equals",value:function(e){return this.id===e.id&&this.uri===e.uri&&this.typeUri===e.typeUri&&this.value===e.value&&this.childrenEquals(e.children)}},{key:"childrenEquals",value:function(e){var t=this;return!this.type.compDefs.some((function(i){var n=i.compDefUri,r=t.children[n],o=e[n];if(i.isOne())return!r.equals(o);if(r.length!==o.length)return!0;var c=0;return r.some((function(e){return!e.equals(o[c++])}))}))}},{key:"clone",value:function(){return d.clone(this)}},{key:"typeName",get:function(){return this.type.value}},{key:"backgroundColor",get:function(){return this.type._getBackgroundColor()||"#f5f7fa"}}]),e}(),N=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.assoc&&(i.assoc=new L(e.assoc)),i}return S(t,e),R(t,[{key:"isType",value:function(){return"dmx.core.topic_type"===this.typeUri||"dmx.core.assoc_type"===this.typeUri}},{key:"isCompDef",value:function(){return!1}},{key:"getRelatedTopics",value:function(e){return g.getTopicRelatedTopics(this.id,e)}},{key:"update",value:function(){return console.log("update",this),g.updateTopic(this)}},{key:"isWritable",value:function(){return o.isTopicWritable(this.id)}},{key:"isTopic",value:function(){return!0}},{key:"isAssoc",value:function(){return!1}},{key:"newViewTopic",value:function(e){return new K({id:this.id,uri:this.uri,typeUri:this.typeUri,value:this.value,children:{},viewProps:e})}},{key:"asType",value:function(){if("dmx.core.topic_type"===this.typeUri)return M.getTopicType(this.uri);if("dmx.core.assoc_type"===this.typeUri)return M.getAssocType(this.uri);throw Error("not a type: "+this)}},{key:"fillRelatingAssoc",value:function(e){this.assoc?this.assoc.fillChildren():this.assoc=new L(e.getInstanceLevelAssocType().emptyInstance())}},{key:"type",get:function(){return M.getTopicType(this.typeUri)}},{key:"icon",get:function(){return this.type._getIcon()||""}},{key:"iconColor",get:function(){return this.type._getColor()||"hsl(210, 50%, 53%)"}}]),t}(q),L=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.player1&&(i.player1=new J(e.player1)),e.player2&&(i.player2=new J(e.player2)),i}return S(t,e),R(t,[{key:"getPlayer",value:function(e){var t=this.player1.roleTypeUri===e,i=this.player2.roleTypeUri===e;if(t&&i)throw Error("both players of association "+this.id+" have role type "+e);return t?this.player1:i?this.player2:void 0}},{key:"hasPlayer",value:function(e){return this.player1.id===e||this.player2.id===e}},{key:"isType",value:function(){return!1}},{key:"isCompDef",value:function(){return"dmx.core.composition_def"===this.typeUri}},{key:"getRelatedTopics",value:function(e){return g.getAssocRelatedTopics(this.id,e)}},{key:"update",value:function(){return console.log("update",this),g.updateAssoc(this)}},{key:"isWritable",value:function(){return o.isAssocWritable(this.id)}},{key:"isTopic",value:function(){return!1}},{key:"isAssoc",value:function(){return!0}},{key:"newViewAssoc",value:function(e){return new Z({id:this.id,uri:this.uri,typeUri:this.typeUri,value:this.value,children:{},player1:this.player1,player2:this.player2,viewProps:e})}},{key:"asCompDef",value:function(){var e=this.getPlayer("dmx.core.parent_type");return M.getTypeById(e.topicId).getCompDefById(this.id)}},{key:"type",get:function(){return M.getAssocType(this.typeUri)}},{key:"color",get:function(){return this.type._getColor()||"hsl(0, 0%, 80%)"}}]),t}(q),J=function(){function e(t){if(B(this,e),-1===t.topicId||-1===t.assocId)throw Error("player ID is -1 in "+JSON.stringify(t));this.topicId=t.topicId,this.topicUri=t.topicUri,this.assocId=t.assocId,this.roleTypeUri=t.roleTypeUri}return R(e,[{key:"getRoleType",value:function(){return M.getRoleType(this.roleTypeUri)}},{key:"isTopicPlayer",value:function(){return this.topicId>=0}},{key:"isAssocPlayer",value:function(){return this.assocId}},{key:"fetch",value:function(){if(this.isTopicPlayer())return g.getTopic(this.topicId);if(this.isAssocPlayer())return g.getAssoc(this.assocId);throw Error("ID not set in player "+JSON.stringify(this))}},{key:"roleTypeName",get:function(){return this.getRoleType().value}},{key:"id",get:function(){if(this.isTopicPlayer())return this.topicId;if(this.isAssocPlayer())return this.assocId;throw Error("ID not set in player "+JSON.stringify(this))}}]),e}(),X=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.assoc=new L(e.assoc),i}return S(t,e),t}(N),F=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.dataTypeUri=e.dataTypeUri,i.compDefs=d.instantiateMany(e.compDefs,Y),i.viewConfig=d.mapByTypeUri(d.instantiateMany(e.viewConfigTopics,N)),i}return S(t,e),R(t,[{key:"isSimple",value:function(){return["dmx.core.text","dmx.core.html","dmx.core.number","dmx.core.boolean"].includes(this.dataTypeUri)}},{key:"isComposite",value:function(){return!this.isSimple()}},{key:"isValue",value:function(){return"dmx.core.value"===this.dataTypeUri}},{key:"isIdentity",value:function(){return"dmx.core.identity"===this.dataTypeUri}},{key:"getDataType",value:function(){return M.getDataType(this.dataTypeUri)}},{key:"getCompDefById",value:function(e){var t=this.compDefs.filter((function(t){return t.id===e}));if(1!==t.length)throw Error('type "'+this.uri+'" has '+t.length+" comp defs with ID "+e);return t[0]}},{key:"getViewConfig",value:function(e){var t=this.viewConfig["dmx.webclient.view_config"];if(t){var i=t.children[e];return i&&i.value}}},{key:"_getColor",value:function(){return this.getViewConfig("dmx.webclient.color")}},{key:"_getBackgroundColor",value:function(){return this.getViewConfig("dmx.webclient.color#dmx.webclient.background_color")}},{key:"emptyInstance",value:function(){var e,t=this;return{id:-1,uri:"",typeUri:this.uri,value:"",children:(e={},t.compDefs.forEach((function(t){var i=t.getChildType().emptyInstance();e[t.compDefUri]=t.isOne()?i:[i]})),e)}}},{key:"toExternalForm",value:function(){var e=JSON.parse(JSON.stringify(this));return e.compDefs.forEach((function(e){e.assocTypeUri=e.typeUri,delete e.typeUri})),console.log("toExternalForm",e),e}}]),t}(N),z=function(e){function t(){return B(this,t),W(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return S(t,e),R(t,[{key:"newTopicModel",value:function(e){return function t(i){var n={typeUri:i},r=M.getTopicType(i);if(r.isSimple())n.value=e;else{var o=r.compDefs[0],c=t(o.childTypeUri);n.children=(s={},a=o.compDefUri,u=o.isOne()?c:[c],a in s?Object.defineProperty(s,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[a]=u,s)}var s,a,u;return n}(this.uri)}},{key:"_getIcon",value:function(){return this.getViewConfig("dmx.webclient.icon")}},{key:"isTopicType",value:function(){return!0}},{key:"isAssocType",value:function(){return!1}},{key:"update",value:function(){return g.updateTopicType(this.toExternalForm())}},{key:"icon",get:function(){return this._getIcon()||""}}]),t}(F),H=function(e){function t(){return B(this,t),W(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return S(t,e),R(t,[{key:"isTopicType",value:function(){return!1}},{key:"isAssocType",value:function(){return!0}},{key:"update",value:function(){return g.updateAssocType(this.toExternalForm())}}]),t}(F),Y=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i.viewConfig=d.mapByTypeUri(d.instantiateMany(e.viewConfigTopics,N)),i.parentTypeUri=i.getPlayer("dmx.core.parent_type").topicUri,i.childTypeUri=i.getPlayer("dmx.core.child_type").topicUri;var n=i.children["dmx.core.assoc_type#dmx.core.custom_assoc_type"];i.customAssocTypeUri=n&&n.uri,i.compDefUri=i.childTypeUri+(i.customAssocTypeUri?"#"+i.customAssocTypeUri:""),i.instanceLevelAssocTypeUri=i.customAssocTypeUri||i._defaultInstanceLevelAssocTypeUri();var r=i.children["dmx.core.cardinality"];if(!r)throw Error("comp def "+i.compDefUri+" has no cardinality child (parent type: "+i.parentTypeUri+")");i.childCardinalityUri=r.uri;var o=i.children["dmx.core.identity_attr"];i.isIdentityAttr=!!o&&o.value;var c=i.children["dmx.core.include_in_label"];return i.includeInLabel=!!c&&c.value,i}return S(t,e),R(t,[{key:"getChildType",value:function(){return M.getTopicType(this.childTypeUri)}},{key:"getInstanceLevelAssocType",value:function(){return M.getAssocType(this.instanceLevelAssocTypeUri)}},{key:"getCustomAssocType",value:function(){return this.customAssocTypeUri&&M.getAssocType(this.customAssocTypeUri)}},{key:"isOne",value:function(){return"dmx.core.one"===this.childCardinalityUri}},{key:"isMany",value:function(){return"dmx.core.many"===this.childCardinalityUri}},{key:"getViewConfig",value:function(e){var t=this._getViewConfig(e);return t&&t.value}},{key:"_getViewConfig",value:function(e){var t=this.viewConfig["dmx.webclient.view_config"];if(t)return t.children[e]}},{key:"_defaultInstanceLevelAssocTypeUri",value:function(){if(!this.isCompDef())throw Error('unexpected association type URI: "'+this.typeUri+'"');return"dmx.core.composition"}},{key:"emptyChildInstance",value:function(){var e=this.getChildType().emptyInstance();return e.assoc=this.getInstanceLevelAssocType().emptyInstance(),new N(e)}}]),t}(L),G=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.topic));return i.viewProps=e.viewProps,i._topics=d.mapById(d.instantiateMany(e.topics,K)),i._assocs=d.mapById(d.instantiateMany(e.assocs,Z)),i}return S(t,e),R(t,[{key:"getTopic",value:function(e){var t=this.getTopicIfExists(e);if(!t)throw Error("topic "+e+" not found in topicmap "+this.id);return t}},{key:"getAssoc",value:function(e){var t=this.getAssocIfExists(e);if(!t)throw Error("assoc "+e+" not found in topicmap "+this.id);return t}},{key:"getObject",value:function(e){var t=this.getTopicIfExists(e)||this.getAssocIfExists(e);if(!t)throw Error("topic/assoc "+e+" not found in topicmap "+this.id);return t}},{key:"getTopicIfExists",value:function(e){return this._topics[e]}},{key:"getAssocIfExists",value:function(e){return this._assocs[e]}},{key:"hasTopic",value:function(e){return this.getTopicIfExists(e)}},{key:"hasAssoc",value:function(e){return this.getAssocIfExists(e)}},{key:"hasObject",value:function(e){return this.hasTopic(e)||this.hasAssoc(e)}},{key:"hasVisibleObject",value:function(e){var t=this.getTopicIfExists(e)||this.getAssocIfExists(e);return t&&t.isVisible()}},{key:"getPosition",value:function(e){var t=this.getObject(e);if(t.isTopic())return t.getPosition();var i=this.getPosition(t.player1.id),n=this.getPosition(t.player2.id);return{x:(i.x+n.x)/2,y:(i.y+n.y)/2}}},{key:"addTopic",value:function(e){if(!(e instanceof K))throw Error("addTopic() expects a ViewTopic, got "+e.constructor.name);b.a.set(this._topics,e.id,e)}},{key:"addAssoc",value:function(e){if(!(e instanceof Z))throw Error("addAssoc() expects a ViewAssoc, got "+e.constructor.name);b.a.set(this._assocs,e.id,e)}},{key:"revealTopic",value:function(e,t){var i={},n=this.getTopicIfExists(e.id);return n?n.isVisible()||(n.setVisibility(!0),i.type="show",i.viewTopic=n):(n=e.newViewTopic(V({},t?{"dmx.topicmaps.x":t.x,"dmx.topicmaps.y":t.y}:void 0,{"dmx.topicmaps.visibility":!0,"dmx.topicmaps.pinned":!1})),this.addTopic(n),i.type="add",i.viewTopic=n),i}},{key:"revealAssoc",value:function(e){var t={},i=this.getAssocIfExists(e.id);return i?i.isVisible()||(i.setVisibility(!0),t.type="show",t.viewAssoc=i):(i=e.newViewAssoc({"dmx.topicmaps.visibility":!0,"dmx.topicmaps.pinned":!1}),this.addAssoc(i),t.type="add",t.viewAssoc=i),t}},{key:"removeTopic",value:function(e){b.a.delete(this._topics,e)}},{key:"removeAssoc",value:function(e){b.a.delete(this._assocs,e)}},{key:"getAssocsWithPlayer",value:function(e){return this.assocs.filter((function(t){return t.hasPlayer(e)}))}},{key:"hideAssocsWithPlayer",value:function(e){var t=this;this.getAssocsWithPlayer(e).forEach((function(e){e.setVisibility(!1),t.hideAssocsWithPlayer(e.id)}))}},{key:"removeAssocsWithPlayer",value:function(e){var t=this;this.getAssocsWithPlayer(e).forEach((function(e){t.removeAssoc(e.id),t.removeAssocsWithPlayer(e.id)}))}},{key:"getOtherPlayer",value:function(e,t){var i=void 0;if(e.player1.id===t)i=e.player2.id;else{if(e.player2.id!==t)throw Error(t+" is not a player in assoc "+JSON.stringify(e));i=e.player1.id}return this.getObject(i)}},{key:"setViewport",value:function(e,t){this.viewProps["dmx.topicmaps.pan_x"]=e.x,this.viewProps["dmx.topicmaps.pan_y"]=e.y,this.viewProps["dmx.topicmaps.zoom"]=t}},{key:"topics",get:function(){return Object.values(this._topics)}},{key:"assocs",get:function(){return Object.values(this._assocs)}}]),t}(N),Q=function(e){return function(e){function t(){return B(this,t),W(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return S(t,e),R(t,[{key:"isVisible",value:function(){return this.getViewProp("dmx.topicmaps.visibility")}},{key:"setVisibility",value:function(e){this.setViewProp("dmx.topicmaps.visibility",e),e||this.setPinned(!1)}},{key:"isPinned",value:function(){return this.getViewProp("dmx.topicmaps.pinned")}},{key:"setPinned",value:function(e){this.setViewProp("dmx.topicmaps.pinned",e)}},{key:"getViewProp",value:function(e){return this.viewProps[e]}},{key:"setViewProp",value:function(e,t){b.a.set(this.viewProps,e,t)}}]),t}(e)},K=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!e.viewProps)throw TypeError('"viewProps" not set in topic passed to ViewTopic constructor; topic='+JSON.stringify(e));return i.viewProps=e.viewProps,i}return S(t,e),R(t,[{key:"fetchObject",value:function(){return g.getTopic(this.id,!0,!0)}},{key:"getPosition",value:function(){return{x:this.getViewProp("dmx.topicmaps.x"),y:this.getViewProp("dmx.topicmaps.y")}}},{key:"setPosition",value:function(e){this.setViewProp("dmx.topicmaps.x",e.x),this.setViewProp("dmx.topicmaps.y",e.y)}}]),t}(Q(N)),Z=function(e){function t(e){B(this,t);var i=W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!e.viewProps)throw TypeError('"viewProps" not set in assoc passed to ViewAssoc constructor; assoc='+JSON.stringify(e));return i.viewProps=e.viewProps,i}return S(t,e),R(t,[{key:"fetchObject",value:function(){return g.getAssoc(this.id,!0,!0)}}]),t}(Q(L));console.log("[DMX] Client Library 2020/03/30");t.default={DMXObject:q,Topic:N,Assoc:L,Player:J,RelatedTopic:X,Type:F,TopicType:z,AssocType:H,Topicmap:G,ViewTopic:K,ViewAssoc:Z,restClient:g,typeCache:M,permCache:o,utils:d,init:function(e){return e.onHttpError&&g.setErrorHandler(e.onHttpError),M.init(e.store)}}}])}));